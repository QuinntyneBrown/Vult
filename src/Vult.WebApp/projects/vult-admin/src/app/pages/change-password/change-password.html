<!-- Copyright (c) Quinntyne Brown. All Rights Reserved.
     Licensed under the MIT License. See License.txt in the project root for license information. -->
<div class="change-password">
  <mat-card class="change-password__card">
    <mat-card-header>
      <mat-card-title>
        <h2>Change Password</h2>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      @if (errorMessage$ | async; as errorMessage) {
        <div class="change-password__error">
          <mat-icon>error</mat-icon>
          {{ errorMessage }}
        </div>
      }

      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <mat-form-field appearance="outline" class="change-password__field">
          <mat-label>Current Password</mat-label>
          <input
            matInput
            [type]="hideOldPassword ? 'password' : 'text'"
            formControlName="oldPassword"
            placeholder="Enter your current password"
          />
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="hideOldPassword = !hideOldPassword"
          >
            <mat-icon>{{ hideOldPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (form.get('oldPassword')?.hasError('required') && form.get('oldPassword')?.touched) {
            <mat-error>Current password is required</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="change-password__field">
          <mat-label>New Password</mat-label>
          <input
            matInput
            [type]="hideNewPassword ? 'password' : 'text'"
            formControlName="newPassword"
            placeholder="Enter your new password"
          />
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="hideNewPassword = !hideNewPassword"
          >
            <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (form.get('newPassword')?.hasError('required') && form.get('newPassword')?.touched) {
            <mat-error>New password is required</mat-error>
          }
          @if (form.get('newPassword')?.hasError('minlength') && form.get('newPassword')?.touched) {
            <mat-error>Password must be at least 6 characters</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="change-password__field">
          <mat-label>Confirm New Password</mat-label>
          <input
            matInput
            [type]="hideConfirmPassword ? 'password' : 'text'"
            formControlName="confirmationPassword"
            placeholder="Confirm your new password"
          />
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="hideConfirmPassword = !hideConfirmPassword"
          >
            <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (form.get('confirmationPassword')?.hasError('required') && form.get('confirmationPassword')?.touched) {
            <mat-error>Password confirmation is required</mat-error>
          }
          @if (form.hasError('passwordMismatch') && form.get('confirmationPassword')?.touched) {
            <mat-error>Passwords do not match</mat-error>
          }
        </mat-form-field>

        <div class="change-password__actions">
          <button mat-button type="button" (click)="onCancel()">Cancel</button>
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="isSaving$ | async"
          >
            @if (isSaving$ | async) {
              <mat-spinner diameter="20"></mat-spinner>
              Saving...
            } @else {
              Change Password
            }
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
