<ng-container *ngIf="viewModel$ | async as vm">
  <main class="products-page" data-testid="products-page">
    <!-- Page Header -->
    <div class="products-page__header" data-testid="products-header">
      <v-page-header
        title="Products"
        [count]="vm.totalProducts"
        alignment="left"
        data-testid="page-header"
      ></v-page-header>

      <div class="products-page__controls">
        <!-- Mobile Filter Toggle -->
        <v-mobile-filter-toggle
          [isActive]="vm.isMobileFilterOpen"
          [activeFilterCount]="vm.activeFilterCount"
          showText="Show Filters"
          hideText="Hide Filters"
          controlsId="filter-sidebar"
          (toggleFilters)="onMobileFilterToggle($event)"
          data-testid="mobile-filter-toggle"
        ></v-mobile-filter-toggle>

        <!-- Sort Dropdown -->
        <v-sort-dropdown
          [options]="sortOptions"
          [selectedOptionId]="vm.selectedSortId"
          label="Sort By:"
          [showLabel]="true"
          (selectionChange)="onSortChange($event)"
          data-testid="sort-dropdown"
        ></v-sort-dropdown>
      </div>
    </div>

    <!-- Content Layout -->
    <div class="products-page__content" data-testid="products-content">
      <!-- Filter Sidebar (Desktop) -->
      <aside
        class="products-page__sidebar"
        [class.products-page__sidebar--mobile-open]="vm.isMobileFilterOpen"
        data-testid="filter-sidebar"
        id="filter-sidebar"
      >
        <v-filter-sidebar
          title="Filters"
          [sections]="vm.filterSections"
          [showCloseButton]="vm.isMobileFilterOpen"
          [showClearButton]="true"
          [isVisible]="true"
          (filterChange)="onFilterChange($event)"
          (clearAll)="onClearFilters()"
          (closePanel)="onCloseMobileFilter()"
          data-testid="filter-sidebar-component"
        ></v-filter-sidebar>
      </aside>

      <!-- Mobile Filter Overlay -->
      <div
        *ngIf="vm.isMobileFilterOpen"
        class="products-page__overlay"
        (click)="onCloseMobileFilter()"
        data-testid="filter-overlay"
      ></div>

      <!-- Product Grid Section -->
      <section class="products-page__grid-section" aria-label="Products">
        <!-- Result Counter -->
        <div class="products-page__result-info" data-testid="result-info">
          <v-result-counter
            [count]="vm.totalProducts"
            singularLabel="Result"
            pluralLabel="Results"
            [loading]="vm.isLoading"
            data-testid="result-counter"
          ></v-result-counter>
        </div>

        <!-- Product Grid -->
        <v-product-grid
          [products]="vm.products"
          [loading]="vm.isLoading"
          [skeletonItems]="12"
          emptyTitle="No products found"
          emptyMessage="Try adjusting your filters or browse all products."
          emptyActionText="Clear Filters"
          emptyActionUrl="#"
          (productClick)="onProductClick($event)"
          (favoriteToggle)="onFavoriteToggle($event)"
          data-testid="product-grid"
        ></v-product-grid>

        <!-- Pagination -->
        <v-pagination
          *ngIf="vm.totalPages > 1"
          variant="numbered"
          [page]="vm.currentPage"
          [totalPages]="vm.totalPages"
          [maxVisiblePages]="7"
          (pageChange)="onPageChange($event)"
          data-testid="pagination"
        ></v-pagination>
      </section>
    </div>
  </main>
</ng-container>
