<main class="product-page" data-testid="product-detail-page">
  <ng-container *ngIf="viewModel$ | async as vm">
    <div class="product-container" data-testid="product-container">
      <!-- Image Gallery Section -->
      <section class="product-gallery-section" aria-label="Product images">
        <v-product-image-gallery
          [images]="vm.product.images"
          [enableZoom]="true"
          [loading]="false"
          [selectedImageIndex]="vm.selectedImageIndex"
          ariaLabel="Product image gallery"
          (imageChange)="onImageChange($event)"
          (imageClick)="onImageClick($event)"
          data-testid="product-image-gallery"
        ></v-product-image-gallery>
      </section>

      <!-- Product Info Section -->
      <section class="product-info-section" aria-label="Product information">
        <!-- Product Header -->
        <v-product-info-section
          [title]="vm.product.title"
          [subtitle]="vm.product.subtitle"
          [price]="vm.product.price"
          [colorName]="vm.selectedColorName"
          [isMemberExclusive]="vm.product.isMemberExclusive || false"
          [promotionalMessage]="vm.product.promotionalMessage || ''"
          data-testid="product-info"
        ></v-product-info-section>

        <!-- Color Selector -->
        <div class="color-selector-section" data-testid="color-selector-section">
          <p class="section-label">
            Color: <strong>{{ vm.selectedColorName }}</strong>
          </p>
          <v-color-swatch-selector
            [colors]="vm.product.colors"
            [selectedColorId]="vm.selectedColorId"
            ariaLabel="Select product color"
            (colorSelect)="onColorSelect($event)"
            data-testid="color-swatch-selector"
          ></v-color-swatch-selector>
        </div>

        <!-- Size Selector -->
        <div class="size-selector-section" data-testid="size-selector-section">
          <div class="size-selector-header">
            <span class="section-label">Select Size</span>
            <button
              type="button"
              class="size-guide-link"
              (click)="onSizeGuideClick()"
              data-testid="size-guide-link"
            >
              Size Guide
            </button>
          </div>
          <v-size-selector
            [sizes]="vm.product.sizes"
            [multiSelect]="false"
            [showStrikethrough]="true"
            [selectedSizeIds]="vm.selectedSizeIds"
            ariaLabel="Select product size"
            (selectionChange)="onSizeSelectionChange($event)"
            data-testid="size-selector"
          ></v-size-selector>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons" data-testid="action-buttons">
          <v-add-to-bag-button
            [disabled]="vm.isAddToBagDisabled"
            [state]="vm.addToBagState"
            [errorMessage]="vm.addToBagError"
            [fullWidth]="true"
            ariaLabel="Add to shopping bag"
            (addToBag)="onAddToBag()"
            data-testid="add-to-bag-button"
          ></v-add-to-bag-button>

          <v-favorites-button
            [isFavorited]="vm.isFavorited"
            [loading]="vm.isFavoriteLoading"
            variant="full-width"
            (favoriteToggle)="onFavoriteToggle($event)"
            data-testid="favorites-button"
          ></v-favorites-button>
        </div>

        <!-- Product Details Accordion -->
        <div class="accordion-section" data-testid="accordion-section">
          <v-product-details-accordion
            [sections]="vm.product.accordionSections"
            [mode]="'multiple'"
            [initialExpandedIds]="vm.expandedAccordionIds"
            ariaLabel="Product details"
            (sectionToggle)="onAccordionSectionToggle($event)"
            data-testid="product-accordion"
          ></v-product-details-accordion>
        </div>
      </section>
    </div>
  </ng-container>
</main>
