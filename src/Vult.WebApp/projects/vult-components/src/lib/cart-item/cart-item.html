<article class="cart-item" [attr.data-testid]="testId">
  <div class="cart-item__image">
    @if (item.imageUrl) {
      <img [src]="item.imageUrl" [alt]="item.name" loading="lazy" />
    } @else {
      <svg width="80" height="80" viewBox="0 0 80 80" fill="#ccc">
        <rect x="10" y="20" width="60" height="40" rx="4"/>
        <circle cx="25" cy="55" r="8"/>
        <circle cx="55" cy="55" r="8"/>
      </svg>
    }
  </div>

  <div class="cart-item__details">
    <div class="cart-item__header">
      <a class="cart-item__name" [href]="'/product/' + item.productId" (click)="onProductClick($event)">
        {{ item.name }}
      </a>
      <div class="cart-item__price-container">
        <span class="cart-item__price" [class.cart-item__price--sale]="item.originalPrice">
          {{ item.price | currency }}
        </span>
        @if (item.originalPrice) {
          <span class="cart-item__original-price">{{ item.originalPrice | currency }}</span>
        }
      </div>
    </div>

    @if (item.subtitle) {
      <div class="cart-item__subtitle">{{ item.subtitle }}</div>
    }

    <div class="cart-item__options">{{ item.color }} | Size: {{ item.size }}</div>

    @if (item.isLowStock) {
      <div class="cart-item__low-stock-warning">Just a Few Left - Order Now</div>
    }

    <v-quantity-selector
      [quantity]="item.quantity"
      [maxQuantity]="item.maxQuantity"
      [testId]="testId + '-quantity'"
      (quantityChange)="onQuantityChange($event)"
    />

    <div class="cart-item__actions">
      <button
        class="cart-item__action-btn"
        [attr.data-testid]="testId + '-remove'"
        (click)="onRemove()"
      >
        Remove
      </button>
      @if (showFavoritesButton) {
        <button
          class="cart-item__action-btn"
          [attr.data-testid]="testId + '-favorite'"
          (click)="onMoveToFavorites()"
        >
          Move to Favorites
        </button>
      }
    </div>
  </div>
</article>
