<div class="promo-code" [attr.data-testid]="testId">
  @if (!isExpanded() && !appliedCode) {
    <button class="promo-code__toggle" (click)="toggleExpanded()">
      <span>{{ toggleLabel }}</span>
      <mat-icon class="promo-code__chevron" [class.promo-code__chevron--open]="isExpanded()">expand_more</mat-icon>
    </button>
  }

  @if (isExpanded() && !appliedCode) {
    <div class="promo-code__form">
      <mat-form-field appearance="outline" class="promo-code__field">
        <mat-label>{{ placeholder }}</mat-label>
        <input
          matInput
          type="text"
          [value]="promoCode()"
          [disabled]="isLoading || disabled()"
          (input)="onInput($event)"
          (blur)="onBlur()"
          (keyup.enter)="onApply()"
        />
        @if (error) {
          <mat-error>{{ error }}</mat-error>
        }
      </mat-form-field>
      <button
        mat-flat-button
        class="promo-code__apply-btn"
        [disabled]="!promoCode() || isLoading || disabled()"
        (click)="onApply()"
      >
        @if (isLoading) {
          <mat-spinner diameter="16"></mat-spinner>
        } @else {
          Apply
        }
      </button>
    </div>
  }

  @if (appliedCode) {
    <div class="promo-code__applied">
      <div class="promo-code__applied-info">
        <mat-icon class="promo-code__applied-icon">check_circle</mat-icon>
        <span class="promo-code__applied-code">{{ appliedCode }}</span>
      </div>
      <button mat-icon-button class="promo-code__remove-btn" aria-label="Remove promo code" (click)="onRemove()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  }
</div>
