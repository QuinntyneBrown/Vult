<aside class="cart-summary" [attr.data-testid]="testId">
  <h2 class="cart-summary__title">{{ title }}</h2>

  <div class="cart-summary__rows">
    <div class="cart-summary__row">
      <span>Subtotal</span>
      <span>{{ data.subtotal | currency }}</span>
    </div>

    <div class="cart-summary__row">
      <span>Estimated Shipping</span>
      <span>
        @if (data.shipping === 'free') {
          Free
        } @else if (data.shipping === 'calculated') {
          -
        } @else {
          {{ data.shipping | currency }}
        }
      </span>
    </div>

    <div class="cart-summary__row">
      <span>Estimated Tax</span>
      <span>
        @if (data.tax === 'calculated') {
          -
        } @else {
          {{ data.tax | currency }}
        }
      </span>
    </div>

    @if (data.discount && data.discount > 0) {
      <div class="cart-summary__row cart-summary__row--discount">
        <span>
          Discount
          @if (data.promoCode) {
            ({{ data.promoCode }})
          }
        </span>
        <span>-{{ data.discount | currency }}</span>
      </div>
    }

    <div class="cart-summary__row cart-summary__row--total">
      <span>Total</span>
      <span>{{ calculatedTotal | currency }}</span>
    </div>
  </div>

  @if (showPromoCode) {
    <v-promo-code-input
      [appliedCode]="data.promoCode || ''"
      [isLoading]="isPromoLoading"
      [error]="promoError"
      [testId]="testId + '-promo'"
      (apply)="onApplyPromo($event)"
      (remove)="onRemovePromo()"
    />
  }

  @if (showCheckoutButton) {
    <button
      class="cart-summary__checkout-btn"
      [disabled]="checkoutDisabled"
      [attr.data-testid]="testId + '-checkout-btn'"
      (click)="onCheckout()"
    >
      {{ checkoutButtonText }}
    </button>
  }

  @if (showPayPalButton) {
    <button
      class="cart-summary__paypal-btn"
      [attr.data-testid]="testId + '-paypal-btn'"
      (click)="onPayPalClick()"
    >
      <svg class="cart-summary__paypal-logo" viewBox="0 0 80 20">
        <text x="0" y="16" font-family="Arial" font-size="14" font-weight="bold" fill="#003087">Pay</text>
        <text x="25" y="16" font-family="Arial" font-size="14" font-weight="bold" fill="#009cde">Pal</text>
      </svg>
    </button>
  }

  @if (deliveryEstimate) {
    <div class="cart-summary__delivery-info">
      <p><strong>Estimated Delivery:</strong> {{ deliveryEstimate }}</p>
    </div>
  }

  @if (freeShippingMessage) {
    <div class="cart-summary__free-shipping" [class.cart-summary__free-shipping--qualified]="freeShippingQualified">
      @if (freeShippingQualified) {
        You qualify for <strong>FREE Shipping!</strong>
      } @else {
        {{ freeShippingMessage }}
      }
    </div>
  }
</aside>
