<!-- Copyright (c) Quinntyne Brown. All Rights Reserved.
     Licensed under the MIT License. See License.txt in the project root for license information. -->
<div class="photo-upload">
  <div class="upload-area" 
       [class.dragging]="isDragging()"
       (dragover)="onDragOver($event)"
       (dragleave)="onDragLeave($event)"
       (drop)="onDrop($event)">
    
    <div class="upload-prompt" *ngIf="photos().length === 0">
      <mat-icon class="upload-icon">cloud_upload</mat-icon>
      <h3>Drag and drop photos here</h3>
      <p>or</p>
      <button mat-raised-button color="primary" class="file-input-button" [disabled]="isUploading()">
        <input type="file" 
               multiple 
               accept="image/*" 
               (change)="onFileSelect($event)"
               [disabled]="isUploading()"
               style="display: none;"
               #fileInput>
        <label (click)="fileInput.click()" style="cursor: pointer; margin: 0;">
          <mat-icon>add_photo_alternate</mat-icon>
          Choose Files
        </label>
      </button>
    </div>

    <div class="photo-previews" *ngIf="photos().length > 0">
      <div class="photo-preview" *ngFor="let photo of photos(); let i = index">
        <img [src]="photo.url" [alt]="photo.file.name">
        <button mat-mini-fab 
                color="warn"
                class="remove-btn" 
                (click)="removePhoto(i)"
                [disabled]="isUploading()"
                type="button">
          <mat-icon>close</mat-icon>
        </button>
        <div class="photo-name">{{ photo.file.name }}</div>
      </div>
      
      <div class="add-more" *ngIf="!isUploading()">
        <button mat-stroked-button class="add-more-button">
          <input type="file" 
                 multiple 
                 accept="image/*" 
                 (change)="onFileSelect($event)"
                 style="display: none;"
                 #addMoreInput>
          <label (click)="addMoreInput.click()" style="cursor: pointer; margin: 0; display: flex; flex-direction: column; align-items: center;">
            <mat-icon>add</mat-icon>
            <span>Add More</span>
          </label>
        </button>
      </div>
    </div>
  </div>

  @if (uploadProgress()) {
    <div class="upload-progress">
      <mat-progress-bar 
        mode="determinate" 
        [value]="(uploadProgress()!.current / uploadProgress()!.total) * 100">
      </mat-progress-bar>
      <p class="progress-text">
        {{ uploadProgress()!.status }} 
        ({{ uploadProgress()!.current }} / {{ uploadProgress()!.total }})
      </p>
    </div>
  }

  @if (errorMessage()) {
    <mat-card class="error-message">
      <mat-card-content>
        <mat-icon color="warn">error</mat-icon>
        {{ errorMessage() }}
      </mat-card-content>
    </mat-card>
  }

  <div class="actions" *ngIf="photos().length > 0">
    <button mat-stroked-button 
            (click)="clearPhotos()"
            [disabled]="isUploading()"
            type="button">
      <mat-icon>clear</mat-icon>
      Clear All
    </button>
    <button mat-raised-button 
            color="primary"
            (click)="uploadPhotos()"
            [disabled]="isUploading()"
            type="button">
      <mat-icon>cloud_upload</mat-icon>
      {{ isUploading() ? 'Uploading...' : 'Upload Photos' }}
    </button>
  </div>
</div>
