<!-- Copyright (c) Quinntyne Brown. All Rights Reserved.
     Licensed under the MIT License. See License.txt in the project root for license information. -->
<div class="catalog-container">
  <header class="catalog-header">
    <h1>Catalog Items</h1>
    <button mat-raised-button color="primary" (click)="toggleUpload()" type="button">
      <mat-icon>{{ showUpload() ? 'expand_less' : 'cloud_upload' }}</mat-icon>
      {{ showUpload() ? 'Hide Upload' : 'Upload Photos' }}
    </button>
  </header>

  <div class="upload-section" *ngIf="showUpload()">
    <app-catalog-item-images-upload (uploadComplete)="onUploadComplete($event)"></app-catalog-item-images-upload>
  </div>

  @if (errorMessage()) {
    <mat-card class="error-card">
      <mat-card-content>
        <mat-icon color="warn">error</mat-icon>
        {{ errorMessage() }}
      </mat-card-content>
    </mat-card>
  }

  @if (isLoading()) {
    <div class="loading">
      <mat-spinner></mat-spinner>
      <p>Loading catalog items...</p>
    </div>
  }

  <div class="catalog-grid" *ngIf="!isLoading()">
    <mat-card class="catalog-item" *ngFor="let item of catalogItems()">
      <img mat-card-image 
           *ngIf="item.catalogItemImages && item.catalogItemImages.length > 0" 
           [src]="'data:image/jpeg;base64,' + item.catalogItemImages[0].imageData"
           [alt]="item.description || 'Catalog item'">
      <div class="placeholder" *ngIf="!item.catalogItemImages || item.catalogItemImages.length === 0">
        <mat-icon>image_not_supported</mat-icon>
        <p>No Image</p>
      </div>
      <mat-card-content>
        <mat-card-title>{{ item.brandName || 'Unknown Brand' }}</mat-card-title>
        <mat-card-subtitle>{{ item.description || 'No description' }}</mat-card-subtitle>
        <div class="item-meta">
          @if (item.size) {
            <mat-chip>Size: {{ item.size }}</mat-chip>
          }
          @if (item.estimatedResaleValue) {
            <mat-chip color="primary">${{ item.estimatedResaleValue.toFixed(2) }}</mat-chip>
          }
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button color="warn" 
                (click)="deleteCatalogItem(item.catalogItemId)"
                type="button">
          <mat-icon>delete</mat-icon>
          Delete
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <div class="empty-state" *ngIf="!isLoading() && catalogItems().length === 0">
    <mat-icon class="empty-icon">inventory_2</mat-icon>
    <h2>No catalog items yet</h2>
    <p>Upload photos to get started</p>
    <button mat-raised-button color="primary" (click)="showUpload.set(true)" type="button">
      <mat-icon>cloud_upload</mat-icon>
      Upload Photos
    </button>
  </div>

  <div class="pagination" *ngIf="!isLoading() && catalogItems().length > 0">
    <button mat-raised-button 
            (click)="previousPage()" 
            [disabled]="pageNumber() === 1"
            type="button">
      <mat-icon>chevron_left</mat-icon>
      Previous
    </button>
    <span class="page-info">Page {{ pageNumber() }}</span>
    <button mat-raised-button 
            (click)="nextPage()"
            [disabled]="catalogItems().length < pageSize()"
            type="button">
      Next
      <mat-icon>chevron_right</mat-icon>
    </button>
  </div>
</div>
